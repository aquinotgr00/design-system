import{p as J}from"./chunks/Button.c45fb4d8.js";import{u as Q}from"./chunks/utils-6ba05f5b.d8ec137d.js";import{u as K}from"./chunks/index.66044519.js";import{f as U}from"./chunks/base64.041d95b4.js";import{u as ee,a as se,b as ae}from"./chunks/index.f92bfe5e.js";import{a as Y}from"./chunks/index.5de8f047.js";import{d as te}from"./chunks/defu.573334b8.js";import{p as ne}from"./chunks/index.7b7086ea.js";import{u as oe}from"./chunks/index.d997e305.js";import{d as le,a5 as re,h as g,f as L,j as pe,a6 as ce,_ as ie,B,a7 as de,a3 as ue,o as _,c as k,A as q,x as m,D as o,z as y,t as j,T as me,y as H,r as ye,n as De,H as Fe,b as x,Q as v,a as T,a4 as X}from"./chunks/framework.76afac0a.js";import{p as he}from"./chunks/Banner.82d505c3.js";import"./chunks/Button.vue_vue_type_style_index_0_lang.3d0b80e1.js";import"./chunks/index.a3ecab28.js";import"./chunks/commonjsHelpers.042e6b4d.js";import"./chunks/use-singleton.69d41701.js";import"./chunks/Banner.vue_vue_type_style_index_0_lang.ecd1587d.js";import"./chunks/20.9669de55.js";import"./chunks/16.f3fd109d.js";var _e=Q,Z=_e.createSVGComponent(Z,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:16,height:16},[{elem:"path",attrs:{d:"M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zM20 22h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2V20H20z"}}]),ve=Z;const fe=ve;var ge=Q,z=ge.createSVGComponent(z,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:24,height:24},[{elem:"path",attrs:{d:"M29,26H3a1,1,0,0,1-1-1V8A1,1,0,0,1,3,7H9.46l1.71-2.55A1,1,0,0,1,12,4h8a1,1,0,0,1,.83.45L22.54,7H29a1,1,0,0,1,1,1V25A1,1,0,0,1,29,26ZM4,24H28V9H22a1,1,0,0,1-.83-.45L19.46,6H12.54L10.83,8.55A1,1,0,0,1,10,9H4Z"}},{elem:"path",attrs:{d:"M16,22a6,6,0,1,1,6-6A6,6,0,0,1,16,22Zm0-10a4,4,0,1,0,4,4A4,4,0,0,0,16,12Z"}}]),Ce=z;const Ae=Ce;var be=Q,W=be.createSVGComponent(W,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:24,height:24},[{elem:"path",attrs:{d:"M18,28A12,12,0,1,0,6,16v6.2L2.4,18.6,1,20l6,6,6-6-1.4-1.4L8,22.2V16H8A10,10,0,1,1,18,26Z"}}]),ke=W;const Te=ke,we="/design-system/assets/shutter.9f40c7bb.wav";function O(e,s=!1){const a=document.createElement("canvas"),r=a.getContext("2d");return a.width=e.videoWidth,a.height=e.videoHeight,s?(r.save(),r.scale(-1,1),r.drawImage(e,0,0,a.width*-1,a.height),r.restore()):r.drawImage(e,0,0,a.width,a.height),a.toDataURL("image/jpeg")}const Pe={meta:{facingMode:"environment"},run({video:e,meta:s,modifier:a}){const r=!!(s.value.mirror&&s.value.mirror!=="preview"),l=O(e.value,r),t=a.value.base64?l:U(l);return{preview:l,result:t}}},Se=le({components:{pButton:J,IconCamera:Ae,IconRetake:Te,IconRotate:fe},directives:{pAspectRatio:ne},props:{modelValue:{type:[globalThis.File,String,Array],default:""},modelModifiers:{type:Object,default:()=>({})},mirror:{type:[Boolean,String],default:void 0},mask:{type:String,default:void 0},adapter:{type:Object,default:Pe},facingMode:{type:String,default:void 0},silent:{type:Boolean,default:!1}},models:{prop:"modelValue",event:"update:modelValue"},emits:["start","change","result","update:modelValue"],setup(e,{emit:s}){const a=K(e),r=re(e,"modelModifiers"),l=g(!1),t=g(!1),p=g(""),c=g(""),n=g(),D=g(),F=ee("camera",{controls:!0}),i=g(0),u=L(()=>te({mirror:e.mirror,mask:e.mask,facingMode:e.facingMode},e.adapter.meta,{autoStart:!1})),{videoInputs:f}=se({requestPermissions:!1,constraints:{video:{facingMode:u.value.facingMode}}}),w=L(()=>{var d,N;return(N=(d=f.value)==null?void 0:d.at(i.value))==null?void 0:N.deviceId}),{stream:C,start:P,stop:I,enabled:b}=ae({videoDeviceId:w,audioDeviceId:!1}),$=L(()=>{const d=[];return u.value.mirror&&d.push("camera--mirror"),u.value.mask?d.push(`camera__mask--${u.value.mask}`):d.push("camera__mask--none"),d});async function S(){var d;F.state.value==="denied"&&await Y({title:"Camera Access Blocked",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),F.state.value==="prompt"&&await Y({title:"Camera Access Required",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),await P(),typeof((d=D.value)==null?void 0:d.play)=="function"&&await D.value.play()}function V(){i.value=(i.value+1)%f.value.length}function E(d){c.value=d}async function M(){var N;l.value=!0;const d=await e.adapter.run({video:D,toast:E,stream:C,meta:u,modifier:r});p.value=d.preview,a.value=d.result,t.value=!0,l.value=!1,b.value=!1,s("result",d.result),s("change",d.result),typeof((N=n.value)==null?void 0:N.play)=="function"&&n.value.play()}async function R(){b.value=!0,t.value=!1,p.value="",c.value=""}function G(){s("start",C.value),u.value.autoStart&&M()}return pe(async()=>{F.isSupported&&(await oe(F.state).not.toBeUndefined(),await S())}),ce(()=>{I()}),{ShutterWav:we,classNames:$,cameras:f,video:D,shutter:n,stream:C,toggle:V,isActive:b,isTaken:t,isProcessing:l,message:c,take:M,retake:R,preview:p,turnOn:S,onStart:G,toast:E,deviceId:w}}});const qe=["data-deviceid"],xe=[".srcObject"],Ie=["src"],Ve={key:2,"data-testid":"camera-off",class:"camera__off-info"},Ee={class:"camera__mask-container"},Me={key:0,"data-testid":"camera-mask",class:"camera__mask"},Re={"data-testid":"camera-toast",class:"camera__toast-text"},Ne={class:"camera__controls"},Be=["src","muted"];function He(e,s,a,r,l,t){const p=B("icon-rotate"),c=B("p-button"),n=B("icon-camera"),D=B("icon-retake"),F=de("p-aspect-ratio");return ue((_(),k("div",{class:De(["camera",e.classNames]),"data-testid":"camera","data-deviceid":e.deviceId},[e.stream?(_(),k("video",{key:0,ref:"video","data-testid":"camera-video",".srcObject":e.stream,class:"camera__video",autoplay:"",muted:"",playsinline:"",onPlay:s[0]||(s[0]=(...i)=>e.onStart&&e.onStart(...i))},null,40,xe)):q("",!0),e.isTaken&&!e.stream?(_(),k("img",{key:1,"data-testid":"camera-result",class:"camera__result",src:e.preview,alt:"camera-result"},null,8,Ie)):q("",!0),!e.isActive&&!e.isTaken?(_(),k("span",Ve," Camera is off ")):q("",!0),m("div",Ee,[e.isTaken?q("",!0):(_(),k("div",Me))]),o(me,{name:"slide-up"},{default:y(()=>[e.message?(_(),k("div",{key:e.message,class:"camera__toast"},[m("div",Re,j(e.message),1)])):q("",!0)]),_:1}),m("div",Ne,[e.cameras.length>1&&!e.isTaken?(_(),H(c,{key:0,"data-testid":"camera-toggle",color:"danger",size:"sm",icon:"",pill:"",onClick:e.toggle},{default:y(()=>[o(p)]),_:1},8,["onClick"])):q("",!0),!e.isActive&&!e.isTaken?(_(),H(c,{key:1,"data-testid":"camera-turn-on",class:"camera__main-control",color:"danger",icon:"",pill:"",onClick:s[1]||(s[1]=i=>e.turnOn())},{default:y(()=>[o(n)]),_:1})):e.isActive&&!e.isTaken?(_(),H(c,{key:2,"data-testid":"camera-take",class:"camera__main-control",color:"danger",icon:"",pill:"",disabled:e.isProcessing,onClick:s[2]||(s[2]=i=>e.take())},{default:y(()=>[o(n)]),_:1},8,["disabled"])):(_(),H(c,{key:3,"data-testid":"camera-retake",class:"camera__main-control",color:"danger",icon:"",pill:"",onClick:s[3]||(s[3]=i=>e.retake())},{default:y(()=>[o(D)]),_:1}))]),m("audio",{ref:"shutter",src:e.ShutterWav,muted:e.silent},null,8,Be),ye(e.$slots,"default",{cameras:e.cameras,preview:e.preview,stream:e.stream,video:e.video,shutter:e.shutter,toast:e.toast})],10,qe)),[[F,4/3,void 0,{fixed:!0}]])}const h=ie(Se,[["render",He]]),Oe=40,$e=15,A=160;function Le(e,s){const a=e.getContext("2d",{willReadFrequently:!0});return a.drawImage(s,s.videoWidth/2-A,s.videoHeight/2-A,A,A,0,0,A,A),a.getImageData(0,0,e.width,e.height)}function Ue(e){const s=e.width/2,a=e.height/2,r=e.width/4,l=e.height/4,t=s-r/2,p=a-l/2,c=new Uint8ClampedArray(r*l),n={centerX:s,centerY:a,width:r,height:l,xPos:t,yPos:p,buffer:c},D=e.data;let F=0;for(let i=n.yPos;i<n.yPos+n.height;i++){let u=i*e.width*4+n.xPos*4+1;for(let f=n.xPos;f<n.xPos+n.width;f++)n.buffer[F++]=D[u],u+=4}return n}function je(e,s){let a=0,r=0,l=0;const t=e.width/4,p=e.height/4,c=e.data;for(let C=s.centerY-p;C<=s.centerY+p-s.height;C++)for(let P=s.centerX-t;P<=s.centerX+t-s.width;P++){let I=0,b=0,$=0;for(let V=0;V<s.height;V++){let E=P*4+1+(C+V)*e.width*4;for(let M=0;M<s.width;M++){const R=c[E];I+=s.buffer[$++]*R,b+=R*R,E+=4}}let S=0;b>0&&(S=I*I/b),S>l&&(l=S,a=P,r=C)}const n=a-s.xPos,D=r-s.yPos,F=Math.sqrt(n*n+D*D),i=t-s.width/2,u=p-s.height/2,f=Math.sqrt(i*i+u*u);let w=F/f*100;return w>100&&(w=100),w}const Qe={meta:{mask:"round",mirror:!0,facingMode:"user"},async run({video:e,toast:s,meta:a,modifier:r}){return await new Promise(l=>{const t=!!(a.value.mirror&&a.value.mirror!=="preview"),p=O(e.value,t),c=document.createElement("canvas");c.width=A,c.height=A;let n;const D=setInterval(function(){if(e.value){const i=Le(c,e.value);if(!n)n=Ue(i);else if(je(i,n)>Oe){const u=O(e.value,t),f=r.value.base64?[u,p]:[U(u),U(p)];clearInterval(D),s(""),l({preview:u,result:f})}}},1e3/$e);s("Move your head slowly. Your photo will be taken automatically")})}},Ye={meta:{mask:"square",facingMode:"environment",autoStart:!0},async run({video:e,toast:s,meta:a}){const r=!!(a.value.mirror&&a.value.mirror!=="preview"),{BrowserQRCodeReader:l}=await Fe(()=>import("./chunks/index.f77e4dd1.js"),[]),p=await new l().decodeOnceFromVideoElement(e.value),c=O(e.value,r),n=p.getText();return s(n),{preview:c,result:n}}},Xe=v("",4),Ze=v("",3),ze=v("",3),We=v("",3),Ge=v("",3),Je=v("",3),Ke=v("",3),es=v("",3),ss=v("",2),as={class:"truncate"},ts=m("h3",{id:"encode-to-base64",tabindex:"-1"},[T("Encode to base64 "),m("a",{class:"header-anchor",href:"#encode-to-base64","aria-label":'Permalink to "Encode to base64"'},"​")],-1),ns=m("p",null,[T("You can add modifier "),m("code",null,"base64"),T(" to your "),m("code",null,"v-model"),T(", it's enforce result to "),m("a",{href:"https://en.wikipedia.org/wiki/Data_URI_scheme",target:"_blank",rel:"noreferrer"},"base64-dataURI"),T(".")],-1),os=m("b",null,"Note!",-1),ls=m("code",null,"v-model.base64",-1),rs=v("",2),ps={class:"truncate"},cs=v("",7),Ss=JSON.parse(`{"title":"Camera · Components","description":"Take picture from user's camera","frontmatter":{"title":"Camera · Components","description":"Take picture from user's camera"},"headers":[],"relativePath":"components/camera/index.md"}`),is={name:"components/camera/index.md"},qs=Object.assign(is,{setup(e){const s=g(),a=g();return(r,l)=>{const t=B("preview");return _(),k("div",null,[Xe,o(t,{class:"flex-col"},{default:y(()=>[o(h)]),_:1}),Ze,o(t,{class:"flex-col"},{default:y(()=>[o(h,{mirror:""})]),_:1}),ze,o(t,{class:"flex-col"},{default:y(()=>[o(h,{mirror:"preview"})]),_:1}),We,o(t,{class:"flex-col space-y-2"},{default:y(()=>[o(h,{mask:"square"}),o(h,{mask:"round"}),o(h,{mask:"card"})]),_:1}),Ge,o(t,{class:"flex-col"},{default:y(()=>[o(h,{silent:""})]),_:1}),Je,o(t,{class:"flex-col space-y-2"},{default:y(()=>[o(h,{adapter:x(Qe)},null,8,["adapter"])]),_:1}),Ke,o(t,{class:"flex-col space-y-2"},{default:y(()=>[o(h,{adapter:x(Ye)},null,8,["adapter"])]),_:1}),es,o(t,{class:"flex-col"},{default:y(()=>[o(h,{modelValue:x(s),"onUpdate:modelValue":l[0]||(l[0]=p=>X(s)?s.value=p:null)},null,8,["modelValue"])]),_:1}),ss,m("pre",as,[m("code",null,j(x(s)),1)]),ts,ns,o(he,{dismissable:!1},{default:y(()=>[os,T(),ls,T(" on QRCodeAdapter has no effect, the result will always original scanned text. ")]),_:1}),o(t,{class:"flex-col"},{default:y(()=>[o(h,{modelValue:x(a),"onUpdate:modelValue":l[1]||(l[1]=p=>X(a)?a.value=p:null),modelModifiers:{base64:!0}},null,8,["modelValue"])]),_:1}),rs,m("pre",ps,[m("code",null,j(x(a)),1)]),cs])}}});export{Ss as __pageData,qs as default};
