import{z as ue,V as oe,W as fe,j as le,X as ee,I as te,u as he}from"../app.20e38cb1.js";var re={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function f(u,s,a){this.fn=u,this.context=s,this.once=a||!1}function _(u,s,a,l,y){if(typeof a!="function")throw new TypeError("The listener must be a function");var w=new f(a,l||u,y),d=t?t+s:s;return u._events[d]?u._events[d].fn?u._events[d]=[u._events[d],w]:u._events[d].push(w):(u._events[d]=w,u._eventsCount++),u}function p(u,s){--u._eventsCount===0?u._events=new i:delete u._events[s]}function h(){this._events=new i,this._eventsCount=0}h.prototype.eventNames=function(){var s=[],a,l;if(this._eventsCount===0)return s;for(l in a=this._events)e.call(a,l)&&s.push(t?l.slice(1):l);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(a)):s},h.prototype.listeners=function(s){var a=t?t+s:s,l=this._events[a];if(!l)return[];if(l.fn)return[l.fn];for(var y=0,w=l.length,d=new Array(w);y<w;y++)d[y]=l[y].fn;return d},h.prototype.listenerCount=function(s){var a=t?t+s:s,l=this._events[a];return l?l.fn?1:l.length:0},h.prototype.emit=function(s,a,l,y,w,d){var E=t?t+s:s;if(!this._events[E])return!1;var o=this._events[E],Q=arguments.length,A,m;if(o.fn){switch(o.once&&this.removeListener(s,o.fn,void 0,!0),Q){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,a),!0;case 3:return o.fn.call(o.context,a,l),!0;case 4:return o.fn.call(o.context,a,l,y),!0;case 5:return o.fn.call(o.context,a,l,y,w),!0;case 6:return o.fn.call(o.context,a,l,y,w,d),!0}for(m=1,A=new Array(Q-1);m<Q;m++)A[m-1]=arguments[m];o.fn.apply(o.context,A)}else{var ae=o.length,O;for(m=0;m<ae;m++)switch(o[m].once&&this.removeListener(s,o[m].fn,void 0,!0),Q){case 1:o[m].fn.call(o[m].context);break;case 2:o[m].fn.call(o[m].context,a);break;case 3:o[m].fn.call(o[m].context,a,l);break;case 4:o[m].fn.call(o[m].context,a,l,y);break;default:if(!A)for(O=1,A=new Array(Q-1);O<Q;O++)A[O-1]=arguments[O];o[m].fn.apply(o[m].context,A)}}return!0},h.prototype.on=function(s,a,l){return _(this,s,a,l,!1)},h.prototype.once=function(s,a,l){return _(this,s,a,l,!0)},h.prototype.removeListener=function(s,a,l,y){var w=t?t+s:s;if(!this._events[w])return this;if(!a)return p(this,w),this;var d=this._events[w];if(d.fn)d.fn===a&&(!y||d.once)&&(!l||d.context===l)&&p(this,w);else{for(var E=0,o=[],Q=d.length;E<Q;E++)(d[E].fn!==a||y&&!d[E].once||l&&d[E].context!==l)&&o.push(d[E]);o.length?this._events[w]=o.length===1?o[0]:o:p(this,w)}return this},h.prototype.removeAllListeners=function(s){var a;return s?(a=t?t+s:s,this._events[a]&&p(this,a)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=t,h.EventEmitter=h,n.exports=h})(re);const ce=re.exports;class ne extends Error{constructor(e){super(e),this.name="TimeoutError"}}let de=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const j=n=>globalThis.DOMException===void 0?new de(n):new DOMException(n),X=n=>{const e=n.reason===void 0?j("This operation was aborted."):n.reason;return e instanceof Error?e:j(e)};function ve(n,e,t,i){let f;const _=new Promise((p,h)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){p(n);return}if(i={customTimers:{setTimeout,clearTimeout},...i},i.signal){const{signal:u}=i;u.aborted&&h(X(u)),u.addEventListener("abort",()=>{h(X(u))})}f=i.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{p(t())}catch(a){h(a)}return}const u=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,s=t instanceof Error?t:new ne(u);typeof n.cancel=="function"&&n.cancel(),h(s)},e),(async()=>{try{p(await n)}catch(u){h(u)}finally{i.customTimers.clearTimeout.call(void 0,f)}})()});return _.clear=()=>{clearTimeout(f),f=void 0},_}function _e(n,e,t){let i=0,f=n.length;for(;f>0;){const _=Math.trunc(f/2);let p=i+_;t(n[p],e)<=0?(i=++p,f-=_+1):f=_}return i}var M=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(n):i?i.value:e.get(n)},T;class me{constructor(){T.set(this,[])}enqueue(e,t){t={priority:0,...t};const i={priority:t.priority,run:e};if(this.size&&M(this,T,"f")[this.size-1].priority>=t.priority){M(this,T,"f").push(i);return}const f=_e(M(this,T,"f"),i,(_,p)=>p.priority-_.priority);M(this,T,"f").splice(f,0,i)}dequeue(){const e=M(this,T,"f").shift();return e==null?void 0:e.run}filter(e){return M(this,T,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return M(this,T,"f").length}}T=new WeakMap;var c=globalThis&&globalThis.__classPrivateFieldSet||function(n,e,t,i,f){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!f:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?f.call(n,t):f?f.value=t:e.set(n,t),t},r=globalThis&&globalThis.__classPrivateFieldGet||function(n,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(n):i?i.value:e.get(n)},v,N,W,C,G,z,q,b,S,P,F,g,k,x,L,H,J,ie,K,U,Z,$,V,Y,R,D;const pe=new ne;class we extends Error{}class ye extends ce{constructor(e){var t,i,f,_;if(super(),v.add(this),N.set(this,void 0),W.set(this,void 0),C.set(this,0),G.set(this,void 0),z.set(this,void 0),q.set(this,0),b.set(this,void 0),S.set(this,void 0),P.set(this,void 0),F.set(this,void 0),g.set(this,0),k.set(this,void 0),x.set(this,void 0),L.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:me,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(i=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(_=(f=e.interval)===null||f===void 0?void 0:f.toString())!==null&&_!==void 0?_:""}\` (${typeof e.interval})`);c(this,N,e.carryoverConcurrencyCount,"f"),c(this,W,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),c(this,G,e.intervalCap,"f"),c(this,z,e.interval,"f"),c(this,P,new e.queueClass,"f"),c(this,F,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,c(this,L,e.throwOnTimeout===!0,"f"),c(this,x,e.autoStart===!1,"f")}get concurrency(){return r(this,k,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);c(this,k,e,"f"),r(this,v,"m",R).call(this)}async add(e,t={}){return new Promise((i,f)=>{const _=async()=>{var p,h,u;c(this,g,(h=r(this,g,"f"),h++,h),"f"),c(this,C,(u=r(this,C,"f"),u++,u),"f");try{if(!((p=t.signal)===null||p===void 0)&&p.aborted){f(new we("The task was aborted."));return}const a=await(this.timeout===void 0&&t.timeout===void 0?e({signal:t.signal}):ve(Promise.resolve(e({signal:t.signal})),t.timeout===void 0?this.timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?r(this,L,"f"):t.throwOnTimeout)&&f(pe)}));i(a),this.emit("completed",a)}catch(s){f(s),this.emit("error",s)}r(this,v,"m",ie).call(this)};r(this,P,"f").enqueue(_,t),r(this,v,"m",$).call(this),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async i=>this.add(i,t)))}start(){return r(this,x,"f")?(c(this,x,!1,"f"),r(this,v,"m",R).call(this),this):this}pause(){c(this,x,!0,"f")}clear(){c(this,P,new(r(this,F,"f")),"f")}async onEmpty(){r(this,P,"f").size!==0&&await r(this,v,"m",D).call(this,"empty")}async onSizeLessThan(e){r(this,P,"f").size<e||await r(this,v,"m",D).call(this,"next",()=>r(this,P,"f").size<e)}async onIdle(){r(this,g,"f")===0&&r(this,P,"f").size===0||await r(this,v,"m",D).call(this,"idle")}get size(){return r(this,P,"f").size}sizeBy(e){return r(this,P,"f").filter(e).length}get pending(){return r(this,g,"f")}get isPaused(){return r(this,x,"f")}}N=new WeakMap,W=new WeakMap,C=new WeakMap,G=new WeakMap,z=new WeakMap,q=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakMap,F=new WeakMap,g=new WeakMap,k=new WeakMap,x=new WeakMap,L=new WeakMap,v=new WeakSet,H=function(){return r(this,W,"f")||r(this,C,"f")<r(this,G,"f")},J=function(){return r(this,g,"f")<r(this,k,"f")},ie=function(){var e;c(this,g,(e=r(this,g,"f"),e--,e),"f"),r(this,v,"m",$).call(this),this.emit("next")},K=function(){this.emit("empty"),r(this,g,"f")===0&&this.emit("idle")},U=function(){r(this,v,"m",Y).call(this),r(this,v,"m",V).call(this),c(this,S,void 0,"f")},Z=function(){const e=Date.now();if(r(this,b,"f")===void 0){const t=r(this,q,"f")-e;if(t<0)c(this,C,r(this,N,"f")?r(this,g,"f"):0,"f");else return r(this,S,"f")===void 0&&c(this,S,setTimeout(()=>{r(this,v,"m",U).call(this)},t),"f"),!0}return!1},$=function(){if(r(this,P,"f").size===0)return r(this,b,"f")&&clearInterval(r(this,b,"f")),c(this,b,void 0,"f"),r(this,v,"m",K).call(this),!1;if(!r(this,x,"f")){const e=!r(this,v,"a",Z);if(r(this,v,"a",H)&&r(this,v,"a",J)){const t=r(this,P,"f").dequeue();return t?(this.emit("active"),t(),e&&r(this,v,"m",V).call(this),!0):!1}}return!1},V=function(){r(this,W,"f")||r(this,b,"f")!==void 0||(c(this,b,setInterval(()=>{r(this,v,"m",Y).call(this)},r(this,z,"f")),"f"),c(this,q,Date.now()+r(this,z,"f"),"f"))},Y=function(){r(this,C,"f")===0&&r(this,g,"f")===0&&r(this,b,"f")&&(clearInterval(r(this,b,"f")),c(this,b,void 0,"f")),c(this,C,r(this,N,"f")?r(this,g,"f"):0,"f"),r(this,v,"m",R).call(this)},R=function(){for(;r(this,v,"m",$).call(this););},D=async function(e,t){return new Promise(i=>{const f=()=>{t&&!t()||(this.off(e,f),i())};this.on(e,f)})};let I,B;const se=new ye({concurrency:1});async function Pe(n,e){if(I||(I=ue(new Map)),!B){const i=document.createElement("div"),f=oe({name:"GlobalContainer",render:()=>[...I.value.values()].map(_=>fe(_.component,{ref:_.ref}))});document.body.append(i),f.mount(i),i.id="global",B=f}let t=I.value.get(n);return t||(t={component:e,ref:le()},I.value.set(n,t),ee(I),await te()),he(t.ref)}async function ge(n){I&&B&&(I.value.delete(n),ee(I),await te())}async function Te(n){return await se.add(()=>Pe(n,n))}async function Ie(n){return await se.add(()=>ge(n))}export{Ie as r,Te as u};
