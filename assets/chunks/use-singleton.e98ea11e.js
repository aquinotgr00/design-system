import{z as ue,W as oe,X as fe,j as le,Y as ee,J as te,u as he}from"../app.34a3cf55.js";var ne={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function f(u,s,a){this.fn=u,this.context=s,this.once=a||!1}function _(u,s,a,l,y){if(typeof a!="function")throw new TypeError("The listener must be a function");var w=new f(a,l||u,y),d=t?t+s:s;return u._events[d]?u._events[d].fn?u._events[d]=[u._events[d],w]:u._events[d].push(w):(u._events[d]=w,u._eventsCount++),u}function p(u,s){--u._eventsCount===0?u._events=new i:delete u._events[s]}function h(){this._events=new i,this._eventsCount=0}h.prototype.eventNames=function(){var s=[],a,l;if(this._eventsCount===0)return s;for(l in a=this._events)e.call(a,l)&&s.push(t?l.slice(1):l);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(a)):s},h.prototype.listeners=function(s){var a=t?t+s:s,l=this._events[a];if(!l)return[];if(l.fn)return[l.fn];for(var y=0,w=l.length,d=new Array(w);y<w;y++)d[y]=l[y].fn;return d},h.prototype.listenerCount=function(s){var a=t?t+s:s,l=this._events[a];return l?l.fn?1:l.length:0},h.prototype.emit=function(s,a,l,y,w,d){var E=t?t+s:s;if(!this._events[E])return!1;var o=this._events[E],Q=arguments.length,A,m;if(o.fn){switch(o.once&&this.removeListener(s,o.fn,void 0,!0),Q){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,a),!0;case 3:return o.fn.call(o.context,a,l),!0;case 4:return o.fn.call(o.context,a,l,y),!0;case 5:return o.fn.call(o.context,a,l,y,w),!0;case 6:return o.fn.call(o.context,a,l,y,w,d),!0}for(m=1,A=new Array(Q-1);m<Q;m++)A[m-1]=arguments[m];o.fn.apply(o.context,A)}else{var ae=o.length,O;for(m=0;m<ae;m++)switch(o[m].once&&this.removeListener(s,o[m].fn,void 0,!0),Q){case 1:o[m].fn.call(o[m].context);break;case 2:o[m].fn.call(o[m].context,a);break;case 3:o[m].fn.call(o[m].context,a,l);break;case 4:o[m].fn.call(o[m].context,a,l,y);break;default:if(!A)for(O=1,A=new Array(Q-1);O<Q;O++)A[O-1]=arguments[O];o[m].fn.apply(o[m].context,A)}}return!0},h.prototype.on=function(s,a,l){return _(this,s,a,l,!1)},h.prototype.once=function(s,a,l){return _(this,s,a,l,!0)},h.prototype.removeListener=function(s,a,l,y){var w=t?t+s:s;if(!this._events[w])return this;if(!a)return p(this,w),this;var d=this._events[w];if(d.fn)d.fn===a&&(!y||d.once)&&(!l||d.context===l)&&p(this,w);else{for(var E=0,o=[],Q=d.length;E<Q;E++)(d[E].fn!==a||y&&!d[E].once||l&&d[E].context!==l)&&o.push(d[E]);o.length?this._events[w]=o.length===1?o[0]:o:p(this,w)}return this},h.prototype.removeAllListeners=function(s){var a;return s?(a=t?t+s:s,this._events[a]&&p(this,a)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=t,h.EventEmitter=h,r.exports=h})(ne);const ce=ne.exports;class re extends Error{constructor(e){super(e),this.name="TimeoutError"}}class de extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const j=r=>globalThis.DOMException===void 0?new de(r):new DOMException(r),J=r=>{const e=r.reason===void 0?j("This operation was aborted."):r.reason;return e instanceof Error?e:j(e)};function ve(r,e,t,i){let f;const _=new Promise((p,h)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){p(r);return}if(i={customTimers:{setTimeout,clearTimeout},...i},i.signal){const{signal:u}=i;u.aborted&&h(J(u)),u.addEventListener("abort",()=>{h(J(u))})}f=i.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{p(t())}catch(a){h(a)}return}const u=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,s=t instanceof Error?t:new re(u);typeof r.cancel=="function"&&r.cancel(),h(s)},e),(async()=>{try{p(await r)}catch(u){h(u)}finally{i.customTimers.clearTimeout.call(void 0,f)}})()});return _.clear=()=>{clearTimeout(f),f=void 0},_}function _e(r,e,t){let i=0,f=r.length;for(;f>0;){const _=Math.trunc(f/2);let p=i+_;t(r[p],e)<=0?(i=++p,f-=_+1):f=_}return i}var M=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},T;class me{constructor(){T.set(this,[])}enqueue(e,t){t={priority:0,...t};const i={priority:t.priority,run:e};if(this.size&&M(this,T,"f")[this.size-1].priority>=t.priority){M(this,T,"f").push(i);return}const f=_e(M(this,T,"f"),i,(_,p)=>p.priority-_.priority);M(this,T,"f").splice(f,0,i)}dequeue(){const e=M(this,T,"f").shift();return e==null?void 0:e.run}filter(e){return M(this,T,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return M(this,T,"f").length}}T=new WeakMap;var c=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,i,f){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!f:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?f.call(r,t):f?f.value=t:e.set(r,t),t},n=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},v,N,W,C,G,z,q,b,S,P,F,g,k,x,L,X,H,ie,K,U,Z,$,Y,V,R,D;const pe=new re;class we extends Error{}class ye extends ce{constructor(e){var t,i,f,_;if(super(),v.add(this),N.set(this,void 0),W.set(this,void 0),C.set(this,0),G.set(this,void 0),z.set(this,void 0),q.set(this,0),b.set(this,void 0),S.set(this,void 0),P.set(this,void 0),F.set(this,void 0),g.set(this,0),k.set(this,void 0),x.set(this,void 0),L.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:me,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(i=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(_=(f=e.interval)===null||f===void 0?void 0:f.toString())!==null&&_!==void 0?_:""}\` (${typeof e.interval})`);c(this,N,e.carryoverConcurrencyCount,"f"),c(this,W,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),c(this,G,e.intervalCap,"f"),c(this,z,e.interval,"f"),c(this,P,new e.queueClass,"f"),c(this,F,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,c(this,L,e.throwOnTimeout===!0,"f"),c(this,x,e.autoStart===!1,"f")}get concurrency(){return n(this,k,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);c(this,k,e,"f"),n(this,v,"m",R).call(this)}async add(e,t={}){return new Promise((i,f)=>{const _=async()=>{var p,h,u;c(this,g,(h=n(this,g,"f"),h++,h),"f"),c(this,C,(u=n(this,C,"f"),u++,u),"f");try{if(!((p=t.signal)===null||p===void 0)&&p.aborted){f(new we("The task was aborted."));return}const a=await(this.timeout===void 0&&t.timeout===void 0?e({signal:t.signal}):ve(Promise.resolve(e({signal:t.signal})),t.timeout===void 0?this.timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?n(this,L,"f"):t.throwOnTimeout)&&f(pe)}));i(a),this.emit("completed",a)}catch(s){f(s),this.emit("error",s)}n(this,v,"m",ie).call(this)};n(this,P,"f").enqueue(_,t),n(this,v,"m",$).call(this),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async i=>this.add(i,t)))}start(){return n(this,x,"f")?(c(this,x,!1,"f"),n(this,v,"m",R).call(this),this):this}pause(){c(this,x,!0,"f")}clear(){c(this,P,new(n(this,F,"f")),"f")}async onEmpty(){n(this,P,"f").size!==0&&await n(this,v,"m",D).call(this,"empty")}async onSizeLessThan(e){n(this,P,"f").size<e||await n(this,v,"m",D).call(this,"next",()=>n(this,P,"f").size<e)}async onIdle(){n(this,g,"f")===0&&n(this,P,"f").size===0||await n(this,v,"m",D).call(this,"idle")}get size(){return n(this,P,"f").size}sizeBy(e){return n(this,P,"f").filter(e).length}get pending(){return n(this,g,"f")}get isPaused(){return n(this,x,"f")}}N=new WeakMap,W=new WeakMap,C=new WeakMap,G=new WeakMap,z=new WeakMap,q=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakMap,F=new WeakMap,g=new WeakMap,k=new WeakMap,x=new WeakMap,L=new WeakMap,v=new WeakSet,X=function(){return n(this,W,"f")||n(this,C,"f")<n(this,G,"f")},H=function(){return n(this,g,"f")<n(this,k,"f")},ie=function(){var e;c(this,g,(e=n(this,g,"f"),e--,e),"f"),n(this,v,"m",$).call(this),this.emit("next")},K=function(){this.emit("empty"),n(this,g,"f")===0&&this.emit("idle")},U=function(){n(this,v,"m",V).call(this),n(this,v,"m",Y).call(this),c(this,S,void 0,"f")},Z=function(){const e=Date.now();if(n(this,b,"f")===void 0){const t=n(this,q,"f")-e;if(t<0)c(this,C,n(this,N,"f")?n(this,g,"f"):0,"f");else return n(this,S,"f")===void 0&&c(this,S,setTimeout(()=>{n(this,v,"m",U).call(this)},t),"f"),!0}return!1},$=function(){if(n(this,P,"f").size===0)return n(this,b,"f")&&clearInterval(n(this,b,"f")),c(this,b,void 0,"f"),n(this,v,"m",K).call(this),!1;if(!n(this,x,"f")){const e=!n(this,v,"a",Z);if(n(this,v,"a",X)&&n(this,v,"a",H)){const t=n(this,P,"f").dequeue();return t?(this.emit("active"),t(),e&&n(this,v,"m",Y).call(this),!0):!1}}return!1},Y=function(){n(this,W,"f")||n(this,b,"f")!==void 0||(c(this,b,setInterval(()=>{n(this,v,"m",V).call(this)},n(this,z,"f")),"f"),c(this,q,Date.now()+n(this,z,"f"),"f"))},V=function(){n(this,C,"f")===0&&n(this,g,"f")===0&&n(this,b,"f")&&(clearInterval(n(this,b,"f")),c(this,b,void 0,"f")),c(this,C,n(this,N,"f")?n(this,g,"f"):0,"f"),n(this,v,"m",R).call(this)},R=function(){for(;n(this,v,"m",$).call(this););},D=async function(e,t){return new Promise(i=>{const f=()=>{t&&!t()||(this.off(e,f),i())};this.on(e,f)})};let I,B;const se=new ye({concurrency:1});async function Pe(r,e){if(I||(I=ue(new Map)),!B){const i=document.createElement("div"),f=oe({name:"GlobalContainer",render:()=>[...I.value.values()].map(_=>fe(_.component,{ref:_.ref}))});document.body.append(i),f.mount(i),i.id="global",B=f}let t=I.value.get(r);return t||(t={component:e,ref:le()},I.value.set(r,t),ee(I),await te()),he(t.ref)}async function ge(r){I&&B&&(I.value.delete(r),ee(I),await te())}async function Ee(r){return await se.add(()=>Pe(r,r))}async function Te(r){return await se.add(()=>ge(r))}export{Te as r,Ee as u};
