import{p as G}from"./chunks/Button.d4222e6c.js";import{u as j}from"./chunks/utils-6ba05f5b.281f2023.js";import{u as J}from"./chunks/index.efda7f73.js";import{f as L}from"./chunks/base64.e46863ef.js";import{u as K,b as ee,c as se}from"./chunks/index.2c42bbf0.js";import{a as Y}from"./chunks/index.d11bdbc5.js";import{i as ae,C as te,j as f,k as $,m as ne,S as oe,U as le,f as re,r as B,V as pe,d as ce,o as v,c as k,t as V,h as m,a as n,w as y,y as U,T as ie,q as N,g as de,n as ue,b as _,e as w,u as Q}from"./app.daa127db.js";import{p as me}from"./chunks/index.d52342a1.js";import{g as ye}from"./chunks/index.e671d653.js";import{B as De}from"./chunks/Banner.d6794381.js";import{B as he}from"./chunks/BrowserQRCodeReader.9511080e.js";import"./chunks/index.69a8ee88.js";import"./chunks/index.e2432ff2.js";import"./chunks/use-singleton.ea81e4a0.js";import"./chunks/Modal.90bb4b88.js";import"./chunks/Heading.e03a6d47.js";import"./chunks/16.37cd8fda.js";import"./chunks/Banner.vue_vue_type_style_index_0_lang.1be0bddb.js";import"./chunks/20.9bfdc640.js";var Fe=j,X=Fe.createSVGComponent(X,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:16,height:16},[{elem:"path",attrs:{d:"M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zM20 22h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2V20H20z"}}]),ve=X;const _e=ve;var ge=j,Z=ge.createSVGComponent(Z,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:24,height:24},[{elem:"path",attrs:{d:"M29,26H3a1,1,0,0,1-1-1V8A1,1,0,0,1,3,7H9.46l1.71-2.55A1,1,0,0,1,12,4h8a1,1,0,0,1,.83.45L22.54,7H29a1,1,0,0,1,1,1V25A1,1,0,0,1,29,26ZM4,24H28V9H22a1,1,0,0,1-.83-.45L19.46,6H12.54L10.83,8.55A1,1,0,0,1,10,9H4Z"}},{elem:"path",attrs:{d:"M16,22a6,6,0,1,1,6-6A6,6,0,0,1,16,22Zm0-10a4,4,0,1,0,4,4A4,4,0,0,0,16,12Z"}}]),fe=Z;const Ce=fe;var Ae=j,z=Ae.createSVGComponent(z,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:24,height:24},[{elem:"path",attrs:{d:"M18,28A12,12,0,1,0,6,16v6.2L2.4,18.6,1,20l6,6,6-6-1.4-1.4L8,22.2V16H8A10,10,0,1,1,18,26Z"}}]),be=z;const ke=be,we="/design-system/assets/shutter.9f40c7bb.wav";function H(e,s=!1){const a=document.createElement("canvas"),r=a.getContext("2d");return a.width=e.videoWidth,a.height=e.videoHeight,s?(r.save(),r.scale(-1,1),r.drawImage(e,0,0,a.width*-1,a.height),r.restore()):r.drawImage(e,0,0,a.width,a.height),a.toDataURL("image/jpeg")}const Te={meta:{facingMode:"environment"},run({video:e,meta:s,modifier:a}){const r=!!(s.value.mirror&&s.value.mirror!=="preview"),o=H(e.value,r),t=a.value.base64?o:L(o);return{preview:o,result:t}}},Se=ae({components:{pButton:G,IconCamera:Ce,IconRetake:ke,IconRotate:_e},directives:{pAspectRatio:me},props:{modelValue:{type:[globalThis.File,String,Array],default:""},modelModifiers:{type:Object,default:()=>({})},mirror:{type:[Boolean,String],default:void 0},mask:{type:String,default:void 0},adapter:{type:Object,default:Te},facingMode:{type:String,default:void 0},silent:{type:Boolean,default:!1}},models:{prop:"modelValue",event:"update:modelValue"},emits:["start","change","result","update:modelValue"],setup(e,{emit:s}){const a=J(e),r=te(e,"modelModifiers"),o=f(!1),t=f(!1),p=f(""),c=f(""),l=f(),D=f(),h=K("camera",{controls:!0}),i=f(0),u=$(()=>le({mirror:e.mirror,mask:e.mask,facingMode:e.facingMode},e.adapter.meta,{autoStart:!1})),{videoInputs:g}=ee({requestPermissions:!1,constraints:{video:{facingMode:u.value.facingMode}}}),T=$(()=>{var d,R;return(R=(d=g.value)==null?void 0:d.at(i.value))==null?void 0:R.deviceId}),{stream:C,start:S,stop:x,enabled:b}=se({videoDeviceId:T,audioDeviceId:!1}),O=$(()=>{const d=[];return u.value.mirror&&d.push("camera--mirror"),u.value.mask?d.push(`camera__mask--${u.value.mask}`):d.push("camera__mask--none"),d});async function P(){var d;h.state.value==="denied"&&await Y({title:"Camera Access Blocked",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),h.state.value==="prompt"&&await Y({title:"Camera Access Required",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),await S(),typeof((d=D.value)==null?void 0:d.play)=="function"&&await D.value.play()}function I(){i.value=(i.value+1)%g.value.length}function E(d){c.value=d}async function M(){var R;o.value=!0;const d=await e.adapter.run({video:D,toast:E,stream:C,meta:u,modifier:r});p.value=d.preview,a.value=d.result,t.value=!0,o.value=!1,b.value=!1,s("result",d.result),s("change",d.result),typeof((R=l.value)==null?void 0:R.play)=="function"&&l.value.play()}async function q(){b.value=!0,t.value=!1,p.value="",c.value=""}function W(){s("start",C.value),u.value.autoStart&&M()}return ne(async()=>{h.isSupported&&(await ye(h.state).not.toBeUndefined(),await P())}),oe(()=>{x()}),{ShutterWav:we,classNames:O,cameras:g,video:D,shutter:l,stream:C,toggle:I,isActive:b,isTaken:t,isProcessing:o,message:c,take:M,retake:q,preview:p,turnOn:P,onStart:W,toast:E,deviceId:T}}});const Pe=["data-deviceid"],Ve=[".srcObject"],xe=["src"],Ie={key:2,"data-testid":"camera-off",class:"camera__off-info"},Ee={class:"camera__mask-container"},Me={key:0,"data-testid":"camera-mask",class:"camera__mask"},qe={"data-testid":"camera-toast",class:"camera__toast-text"},Re={class:"camera__controls"},Be=["src","muted"];function Ne(e,s,a,r,o,t){const p=B("icon-rotate"),c=B("p-button"),l=B("icon-camera"),D=B("icon-retake"),h=pe("p-aspect-ratio");return ce((v(),k("div",{class:ue(["camera",e.classNames]),"data-testid":"camera","data-deviceid":e.deviceId},[e.stream?(v(),k("video",{key:0,ref:"video","data-testid":"camera-video",".srcObject":e.stream,class:"camera__video",autoplay:"",muted:"",playsinline:"",onPlay:s[0]||(s[0]=(...i)=>e.onStart&&e.onStart(...i))},null,40,Ve)):V("",!0),e.isTaken&&!e.stream?(v(),k("img",{key:1,"data-testid":"camera-result",class:"camera__result",src:e.preview,alt:"camera-result"},null,8,xe)):V("",!0),!e.isActive&&!e.isTaken?(v(),k("span",Ie," Camera is off ")):V("",!0),m("div",Ee,[e.isTaken?V("",!0):(v(),k("div",Me))]),n(ie,{name:"slide-up"},{default:y(()=>[e.message?(v(),k("div",{key:e.message,class:"camera__toast"},[m("div",qe,U(e.message),1)])):V("",!0)]),_:1}),m("div",Re,[e.cameras.length>1&&!e.isTaken?(v(),N(c,{key:0,"data-testid":"camera-toggle",color:"secondary",size:"sm",icon:"",pill:"",onClick:e.toggle},{default:y(()=>[n(p)]),_:1},8,["onClick"])):V("",!0),!e.isActive&&!e.isTaken?(v(),N(c,{key:1,"data-testid":"camera-turn-on",class:"camera__main-control",icon:"",pill:"",onClick:s[1]||(s[1]=i=>e.turnOn())},{default:y(()=>[n(l)]),_:1})):e.isActive&&!e.isTaken?(v(),N(c,{key:2,"data-testid":"camera-take",class:"camera__main-control",icon:"",pill:"",disabled:e.isProcessing,onClick:s[2]||(s[2]=i=>e.take())},{default:y(()=>[n(l)]),_:1},8,["disabled"])):(v(),N(c,{key:3,"data-testid":"camera-retake",class:"camera__main-control",icon:"",pill:"",onClick:s[3]||(s[3]=i=>e.retake())},{default:y(()=>[n(D)]),_:1}))]),m("audio",{ref:"shutter",src:e.ShutterWav,muted:e.silent},null,8,Be),de(e.$slots,"default",{cameras:e.cameras,preview:e.preview,stream:e.stream,video:e.video,shutter:e.shutter,toast:e.toast})],10,Pe)),[[h,4/3,void 0,{fixed:!0}]])}const F=re(Se,[["render",Ne]]),He=40,Oe=15,A=160;function $e(e,s){const a=e.getContext("2d",{willReadFrequently:!0});return a.drawImage(s,s.videoWidth/2-A,s.videoHeight/2-A,A,A,0,0,A,A),a.getImageData(0,0,e.width,e.height)}function Le(e){const s=e.width/2,a=e.height/2,r=e.width/4,o=e.height/4,t=s-r/2,p=a-o/2,c=new Uint8ClampedArray(r*o),l={centerX:s,centerY:a,width:r,height:o,xPos:t,yPos:p,buffer:c},D=e.data;let h=0;for(let i=l.yPos;i<l.yPos+l.height;i++){let u=i*e.width*4+l.xPos*4+1;for(let g=l.xPos;g<l.xPos+l.width;g++)l.buffer[h++]=D[u],u+=4}return l}function Ue(e,s){let a=0,r=0,o=0;const t=e.width/4,p=e.height/4,c=e.data;for(let C=s.centerY-p;C<=s.centerY+p-s.height;C++)for(let S=s.centerX-t;S<=s.centerX+t-s.width;S++){let x=0,b=0,O=0;for(let I=0;I<s.height;I++){let E=S*4+1+(C+I)*e.width*4;for(let M=0;M<s.width;M++){const q=c[E];x+=s.buffer[O++]*q,b+=q*q,E+=4}}let P=0;b>0&&(P=x*x/b),P>o&&(o=P,a=S,r=C)}const l=a-s.xPos,D=r-s.yPos,h=Math.sqrt(l*l+D*D),i=t-s.width/2,u=p-s.height/2,g=Math.sqrt(i*i+u*u);let T=h/g*100;return T>100&&(T=100),T}const je={meta:{mask:"round",mirror:!0,facingMode:"user"},async run({video:e,toast:s,meta:a,modifier:r}){return await new Promise(o=>{const t=!!(a.value.mirror&&a.value.mirror!=="preview"),p=H(e.value,t),c=document.createElement("canvas");c.width=A,c.height=A;let l;const D=setInterval(function(){if(e.value){const i=$e(c,e.value);if(!l)l=Le(i);else if(Ue(i,l)>He){const u=H(e.value,t),g=r.value.base64?[u,p]:[L(u),L(p)];clearInterval(D),s(""),o({preview:u,result:g})}}},1e3/Oe);s("Move your head slowly. Your photo will be taken automatically")})}},Ye={meta:{mask:"square",facingMode:"environment",autoStart:!0},async run({video:e,toast:s,meta:a}){const r=!!(a.value.mirror&&a.value.mirror!=="preview"),t=await new he().decodeOnceFromVideoElement(e.value),p=H(e.value,r),c=t.getText();return s(c),{preview:p,result:c}}},Qe=_("",4),Xe=_("",3),Ze=_("",3),ze=_("",3),We=_("",3),Ge=_("",3),Je=_("",3),Ke=_("",3),es=_("",2),ss={class:"truncate"},as=m("h3",{id:"encode-to-base64",tabindex:"-1"},[w("Encode to base64 "),m("a",{class:"header-anchor",href:"#encode-to-base64","aria-hidden":"true"},"#")],-1),ts=m("p",null,[w("You can add modifier "),m("code",null,"base64"),w(" to your "),m("code",null,"v-model"),w(", it's enforce result to "),m("a",{href:"https://en.wikipedia.org/wiki/Data_URI_scheme",target:"_blank",rel:"noreferrer"},"base64-dataURI"),w(".")],-1),ns=m("b",null,"Note!",-1),os=m("code",null,"v-model.base64",-1),ls=_("",2),rs={class:"truncate"},ps=_("",7),Ps=JSON.parse('{"title":"Camera","description":"","frontmatter":{},"headers":[{"level":2,"title":"Usage","slug":"usage","link":"#usage","children":[{"level":3,"title":"Simple Usage","slug":"simple-usage","link":"#simple-usage","children":[]}]},{"level":2,"title":"Mirror Mode","slug":"mirror-mode","link":"#mirror-mode","children":[{"level":3,"title":"Preview-only mirror mode","slug":"preview-only-mirror-mode","link":"#preview-only-mirror-mode","children":[]}]},{"level":2,"title":"Masking","slug":"masking","link":"#masking","children":[]},{"level":2,"title":"Silent","slug":"silent","link":"#silent","children":[]},{"level":2,"title":"Liveness","slug":"liveness","link":"#liveness","children":[]},{"level":2,"title":"QR Scanner","slug":"qr-scanner","link":"#qr-scanner","children":[]},{"level":2,"title":"Binding v-model","slug":"binding-v-model","link":"#binding-v-model","children":[{"level":3,"title":"Encode to base64","slug":"encode-to-base64","link":"#encode-to-base64","children":[]}]},{"level":2,"title":"API","slug":"api","link":"#api","children":[{"level":3,"title":"Props","slug":"props","link":"#props","children":[]},{"level":3,"title":"Slots","slug":"slots","link":"#slots","children":[]},{"level":3,"title":"Events","slug":"events","link":"#events","children":[]}]}],"relativePath":"components/camera/index.md"}'),cs={name:"components/camera/index.md"},Vs=Object.assign(cs,{setup(e){const s=f(),a=f();return(r,o)=>{const t=B("preview");return v(),k("div",null,[Qe,n(t,{class:"flex-col"},{default:y(()=>[n(F)]),_:1}),Xe,n(t,{class:"flex-col"},{default:y(()=>[n(F,{mirror:""})]),_:1}),Ze,n(t,{class:"flex-col"},{default:y(()=>[n(F,{mirror:"preview"})]),_:1}),ze,n(t,{class:"flex-col space-y-2"},{default:y(()=>[n(F,{mask:"square"}),n(F,{mask:"round"}),n(F,{mask:"card"})]),_:1}),We,n(t,{class:"flex-col"},{default:y(()=>[n(F,{silent:""})]),_:1}),Ge,n(t,{class:"flex-col space-y-2"},{default:y(()=>[n(F,{adapter:Q(je)},null,8,["adapter"])]),_:1}),Je,n(t,{class:"flex-col space-y-2"},{default:y(()=>[n(F,{adapter:Q(Ye)},null,8,["adapter"])]),_:1}),Ke,n(t,{class:"flex-col"},{default:y(()=>[n(F,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=p=>s.value=p)},null,8,["modelValue"])]),_:1}),es,m("pre",ss,[m("code",null,U(s.value),1)]),as,ts,n(De,{dismissable:!1},{default:y(()=>[ns,w(),os,w(" on QRCodeAdapter has no effect, the result will always original scanned text. ")]),_:1}),n(t,{class:"flex-col"},{default:y(()=>[n(F,{modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=p=>a.value=p),modelModifiers:{base64:!0}},null,8,["modelValue"])]),_:1}),ls,m("pre",rs,[m("code",null,U(a.value),1)]),ps])}}});export{Ps as __pageData,Vs as default};
