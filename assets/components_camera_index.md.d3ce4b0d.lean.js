import{p as ee}from"./chunks/Button.f34463f3.js";import{g as Y}from"./chunks/commonjsHelpers.042e6b4d.js";import{u as Q}from"./chunks/utils-6ba05f5b.d2d98216.js";import{u as ae}from"./chunks/index.745ddc6c.js";import{f as U}from"./chunks/base64.041d95b4.js";import{u as se,a as te,b as oe,c as ne}from"./chunks/theme.113d465d.js";import{a as X}from"./chunks/index.9c144fcf.js";import{d as le}from"./chunks/defu.573334b8.js";import{p as re}from"./chunks/index.ab737f09.js";import{m as pe,t as ce,r as g,c as O,o as ie,h as de,_ as ue,K as B,a8 as me,a7 as ye,x as _,p as k,J as q,F as m,M as n,I as y,z as j,T as De,H as $,q as Fe,v as he,Q as _e,u as x,Y as v,y as T,i as Z}from"./chunks/framework.e0781a45.js";import{p as ve}from"./chunks/Banner.f7630ae0.js";import"./chunks/index.a3ecab28.js";import"./chunks/Button.vue_vue_type_style_index_0_lang.4ed993c7.js";import"./chunks/use-singleton.f1c30d9d.js";import"./chunks/20.f775a23e.js";import"./chunks/16.1e6106f8.js";import"./chunks/Banner.vue_vue_type_style_index_0_lang.4ed993c7.js";var fe=Q,z=fe.createSVGComponent(z,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:16,height:16},[{elem:"path",attrs:{d:"M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zM20 22h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2V20H20z"}}]),ge=z;const Ce=Y(ge);var Ae=Q,W=Ae.createSVGComponent(W,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:24,height:24},[{elem:"path",attrs:{d:"M29,26H3a1,1,0,0,1-1-1V8A1,1,0,0,1,3,7H9.46l1.71-2.55A1,1,0,0,1,12,4h8a1,1,0,0,1,.83.45L22.54,7H29a1,1,0,0,1,1,1V25A1,1,0,0,1,29,26ZM4,24H28V9H22a1,1,0,0,1-.83-.45L19.46,6H12.54L10.83,8.55A1,1,0,0,1,10,9H4Z"}},{elem:"path",attrs:{d:"M16,22a6,6,0,1,1,6-6A6,6,0,0,1,16,22Zm0-10a4,4,0,1,0,4,4A4,4,0,0,0,16,12Z"}}]),be=W;const ke=Y(be);var Te=Q,G=Te.createSVGComponent(G,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:24,height:24},[{elem:"path",attrs:{d:"M18,28A12,12,0,1,0,6,16v6.2L2.4,18.6,1,20l6,6,6-6-1.4-1.4L8,22.2V16H8A10,10,0,1,1,18,26Z"}}]),we=G;const Pe=Y(we),Se="/design-system/assets/shutter.9f40c7bb.wav";function L(e,a=!1){const s=document.createElement("canvas"),r=s.getContext("2d");return s.width=e.videoWidth,s.height=e.videoHeight,a?(r.save(),r.scale(-1,1),r.drawImage(e,0,0,s.width*-1,s.height),r.restore()):r.drawImage(e,0,0,s.width,s.height),s.toDataURL("image/jpeg")}const qe={meta:{facingMode:"environment"},run({video:e,meta:a,modifier:s}){const r=!!(a.value.mirror&&a.value.mirror!=="preview"),l=L(e.value,r),t=s.value.base64?l:U(l);return{preview:l,result:t}}},xe=pe({components:{pButton:ee,IconCamera:ke,IconRetake:Pe,IconRotate:Ce},directives:{pAspectRatio:re},props:{modelValue:{type:[globalThis.File,String,Array],default:""},modelModifiers:{type:Object,default:()=>({})},mirror:{type:[Boolean,String],default:void 0},mask:{type:String,default:void 0},adapter:{type:Object,default:qe},facingMode:{type:String,default:void 0},silent:{type:Boolean,default:!1}},models:{prop:"modelValue",event:"update:modelValue"},emits:["start","change","result","update:modelValue"],setup(e,{emit:a}){const s=ae(e),r=ce(e,"modelModifiers"),l=g(!1),t=g(!1),p=g(""),c=g(""),o=g(),D=g(),F=se("camera",{controls:!0}),i=g(0),u=O(()=>le({mirror:e.mirror,mask:e.mask,facingMode:e.facingMode},e.adapter.meta,{autoStart:!1})),{videoInputs:f}=te({requestPermissions:!1,constraints:{video:{facingMode:u.value.facingMode}}}),w=O(()=>{var d,N;return(N=(d=f.value)==null?void 0:d.at(i.value))==null?void 0:N.deviceId}),b=O(()=>({video:{deviceId:w.value},audio:!1})),{stream:C,start:E,stop:I,enabled:V}=oe({constraints:b}),M=O(()=>{const d=[];return u.value.mirror&&d.push("camera--mirror"),u.value.mask?d.push(`camera__mask--${u.value.mask}`):d.push("camera__mask--none"),d});async function P(){var d;F.state.value==="denied"&&await X({title:"Camera Access Blocked",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),F.state.value==="prompt"&&await X({title:"Camera Access Required",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),await E(),typeof((d=D.value)==null?void 0:d.play)=="function"&&await D.value.play()}function H(){i.value=(i.value+1)%f.value.length}function R(d){c.value=d}async function S(){var N;l.value=!0;const d=await e.adapter.run({video:D,toast:R,stream:C,meta:u,modifier:r});p.value=d.preview,s.value=d.result,t.value=!0,l.value=!1,V.value=!1,a("result",d.result),a("change",d.result),typeof((N=o.value)==null?void 0:N.play)=="function"&&o.value.play()}async function J(){V.value=!0,t.value=!1,p.value="",c.value=""}function K(){a("start",C.value),u.value.autoStart&&S()}return ie(async()=>{F.isSupported&&(await ne(F.state).not.toBeUndefined(),await P())}),de(()=>{I()}),{ShutterWav:Se,classNames:M,cameras:f,video:D,shutter:o,stream:C,toggle:H,isActive:V,isTaken:t,isProcessing:l,message:c,take:S,retake:J,preview:p,turnOn:P,onStart:K,toast:R,deviceId:w,constraints:b}}});const Ee=["data-deviceid"],Ie=[".srcObject"],Ve=["src"],Me={key:2,"data-testid":"camera-off",class:"camera__off-info"},Re={class:"camera__mask-container"},Ne={key:0,"data-testid":"camera-mask",class:"camera__mask"},Be={"data-testid":"camera-toast",class:"camera__toast-text"},He={class:"camera__controls"},Oe=["src","muted"];function $e(e,a,s,r,l,t){const p=B("icon-rotate"),c=B("p-button"),o=B("icon-camera"),D=B("icon-retake"),F=me("p-aspect-ratio");return ye((_(),k("div",{class:he(["camera",e.classNames]),"data-testid":"camera","data-deviceid":e.deviceId},[e.stream?(_(),k("video",{key:0,ref:"video","data-testid":"camera-video",".srcObject":e.stream,class:"camera__video",autoplay:"",muted:"",playsinline:"",onPlay:a[0]||(a[0]=(...i)=>e.onStart&&e.onStart(...i))},null,40,Ie)):q("",!0),e.isTaken&&!e.stream?(_(),k("img",{key:1,"data-testid":"camera-result",class:"camera__result",src:e.preview,alt:"camera-result"},null,8,Ve)):q("",!0),!e.isActive&&!e.isTaken?(_(),k("span",Me," Camera is off ")):q("",!0),m("div",Re,[e.isTaken?q("",!0):(_(),k("div",Ne))]),n(De,{name:"slide-up"},{default:y(()=>[e.message?(_(),k("div",{key:e.message,class:"camera__toast"},[m("div",Be,j(e.message),1)])):q("",!0)]),_:1}),m("div",He,[e.cameras.length>1&&!e.isTaken?(_(),$(c,{key:0,"data-testid":"camera-toggle",color:"danger",size:"sm",icon:"",pill:"",onClick:e.toggle},{default:y(()=>[n(p)]),_:1},8,["onClick"])):q("",!0),!e.isActive&&!e.isTaken?(_(),$(c,{key:1,"data-testid":"camera-turn-on",class:"camera__main-control",color:"danger",icon:"",pill:"",onClick:a[1]||(a[1]=i=>e.turnOn())},{default:y(()=>[n(o)]),_:1})):e.isActive&&!e.isTaken?(_(),$(c,{key:2,"data-testid":"camera-take",class:"camera__main-control",color:"danger",icon:"",pill:"",disabled:e.isProcessing,onClick:a[2]||(a[2]=i=>e.take())},{default:y(()=>[n(o)]),_:1},8,["disabled"])):(_(),$(c,{key:3,"data-testid":"camera-retake",class:"camera__main-control",color:"danger",icon:"",pill:"",onClick:a[3]||(a[3]=i=>e.retake())},{default:y(()=>[n(D)]),_:1}))]),m("audio",{ref:"shutter",src:e.ShutterWav,muted:e.silent},null,8,Oe),Fe(e.$slots,"default",{cameras:e.cameras,preview:e.preview,stream:e.stream,video:e.video,shutter:e.shutter,toast:e.toast})],10,Ee)),[[F,4/3,void 0,{fixed:!0}]])}const h=ue(xe,[["render",$e]]),Le=40,Ue=15,A=160;function je(e,a){const s=e.getContext("2d",{willReadFrequently:!0});return s.drawImage(a,a.videoWidth/2-A,a.videoHeight/2-A,A,A,0,0,A,A),s.getImageData(0,0,e.width,e.height)}function Ye(e){const a=e.width/2,s=e.height/2,r=e.width/4,l=e.height/4,t=a-r/2,p=s-l/2,c=new Uint8ClampedArray(r*l),o={centerX:a,centerY:s,width:r,height:l,xPos:t,yPos:p,buffer:c},D=e.data;let F=0;for(let i=o.yPos;i<o.yPos+o.height;i++){let u=i*e.width*4+o.xPos*4+1;for(let f=o.xPos;f<o.xPos+o.width;f++)o.buffer[F++]=D[u],u+=4}return o}function Qe(e,a){let s=0,r=0,l=0;const t=e.width/4,p=e.height/4,c=e.data;for(let b=a.centerY-p;b<=a.centerY+p-a.height;b++)for(let C=a.centerX-t;C<=a.centerX+t-a.width;C++){let E=0,I=0,V=0;for(let P=0;P<a.height;P++){let H=C*4+1+(b+P)*e.width*4;for(let R=0;R<a.width;R++){const S=c[H];E+=a.buffer[V++]*S,I+=S*S,H+=4}}let M=0;I>0&&(M=E*E/I),M>l&&(l=M,s=C,r=b)}const o=s-a.xPos,D=r-a.yPos,F=Math.sqrt(o*o+D*D),i=t-a.width/2,u=p-a.height/2,f=Math.sqrt(i*i+u*u);let w=F/f*100;return w>100&&(w=100),w}const Xe={meta:{mask:"round",mirror:!0,facingMode:"user"},async run({video:e,toast:a,meta:s,modifier:r}){return await new Promise(l=>{const t=!!(s.value.mirror&&s.value.mirror!=="preview"),p=L(e.value,t),c=document.createElement("canvas");c.width=A,c.height=A;let o;const D=setInterval(function(){if(e.value){const i=je(c,e.value);if(!o)o=Ye(i);else if(Qe(i,o)>Le){const u=L(e.value,t),f=r.value.base64?[u,p]:[U(u),U(p)];clearInterval(D),a(""),l({preview:u,result:f})}}},1e3/Ue);a("Move your head slowly. Your photo will be taken automatically")})}},Ze={meta:{mask:"square",facingMode:"environment",autoStart:!0},async run({video:e,toast:a,meta:s}){const r=!!(s.value.mirror&&s.value.mirror!=="preview"),{BrowserQRCodeReader:l}=await _e(()=>import("./chunks/index.504f62d5.js"),[]),p=await new l().decodeOnceFromVideoElement(e.value),c=L(e.value,r),o=p.getText();return a(o),{preview:c,result:o}}},ze=v("",4),We=v("",3),Ge=v("",3),Je=v("",3),Ke=v("",3),ea=v("",3),aa=v("",3),sa=v("",3),ta=v("",2),oa={class:"truncate"},na=m("h3",{id:"encode-to-base64",tabindex:"-1"},[T("Encode to base64 "),m("a",{class:"header-anchor",href:"#encode-to-base64","aria-label":'Permalink to "Encode to base64"'},"​")],-1),la=m("p",null,[T("You can add modifier "),m("code",null,"base64"),T(" to your "),m("code",null,"v-model"),T(", it's enforce result to "),m("a",{href:"https://en.wikipedia.org/wiki/Data_URI_scheme",target:"_blank",rel:"noreferrer"},"base64-dataURI"),T(".")],-1),ra=m("b",null,"Note!",-1),pa=m("code",null,"v-model.base64",-1),ca=v("",2),ia={class:"truncate"},da=v("",7),qa=JSON.parse(`{"title":"Camera · Components","description":"Take picture from user's camera","frontmatter":{"title":"Camera · Components","description":"Take picture from user's camera"},"headers":[],"relativePath":"components/camera/index.md","filePath":"components/camera/index.md"}`),ua={name:"components/camera/index.md"},xa=Object.assign(ua,{setup(e){const a=g(),s=g();return(r,l)=>{const t=B("preview");return _(),k("div",null,[ze,n(t,{class:"flex-col"},{default:y(()=>[n(h)]),_:1}),We,n(t,{class:"flex-col"},{default:y(()=>[n(h,{mirror:""})]),_:1}),Ge,n(t,{class:"flex-col"},{default:y(()=>[n(h,{mirror:"preview"})]),_:1}),Je,n(t,{class:"flex-col space-y-2"},{default:y(()=>[n(h,{mask:"square"}),n(h,{mask:"round"}),n(h,{mask:"card"})]),_:1}),Ke,n(t,{class:"flex-col"},{default:y(()=>[n(h,{silent:""})]),_:1}),ea,n(t,{class:"flex-col space-y-2"},{default:y(()=>[n(h,{adapter:x(Xe)},null,8,["adapter"])]),_:1}),aa,n(t,{class:"flex-col space-y-2"},{default:y(()=>[n(h,{adapter:x(Ze)},null,8,["adapter"])]),_:1}),sa,n(t,{class:"flex-col"},{default:y(()=>[n(h,{modelValue:x(a),"onUpdate:modelValue":l[0]||(l[0]=p=>Z(a)?a.value=p:null)},null,8,["modelValue"])]),_:1}),ta,m("pre",oa,[m("code",null,j(x(a)),1)]),na,la,n(ve,{dismissable:!1},{default:y(()=>[ra,T(),pa,T(" on QRCodeAdapter has no effect, the result will always original scanned text. ")]),_:1}),n(t,{class:"flex-col"},{default:y(()=>[n(h,{modelValue:x(s),"onUpdate:modelValue":l[1]||(l[1]=p=>Z(s)?s.value=p:null),modelModifiers:{base64:!0}},null,8,["modelValue"])]),_:1}),ca,m("pre",ia,[m("code",null,j(x(s)),1)]),da])}}});export{qa as __pageData,xa as default};
