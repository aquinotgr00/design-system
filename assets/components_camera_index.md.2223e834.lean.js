import{p as J}from"./chunks/Button.b7f1afdc.js";import{u as Y}from"./chunks/utils-6ba05f5b.e32b901d.js";import{u as K}from"./chunks/index.19ffc2d2.js";import{f as U}from"./chunks/base64.041d95b4.js";import{u as ee,b as se,c as ae}from"./chunks/index.6466d737.js";import{a as Q}from"./chunks/index.c363352f.js";import{f as te,D as ne,g as f,h as $,j as oe,P as le,U as re,k as pe,r as B,V as ce,d as ie,o as _,c as k,t as P,m,a as o,w as y,y as j,T as de,q as O,l as ue,n as me,_ as ye,u as V,b as v,e as w,L as X}from"./app.b87bba93.js";import{p as he}from"./chunks/index.91d8ffdc.js";import{h as De}from"./chunks/index.db339736.js";import{B as Fe}from"./chunks/Banner.0f92b249.js";import"./chunks/Button.vue_vue_type_style_index_0_lang.be67f33c.js";import"./chunks/use-singleton.eadfba7b.js";import"./chunks/Banner.vue_vue_type_style_index_0_lang.c379f6fe.js";import"./chunks/20.aeb729f1.js";import"./chunks/16.e455daa6.js";var _e=Y,Z=_e.createSVGComponent(Z,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:16,height:16},[{elem:"path",attrs:{d:"M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zM20 22h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2V20H20z"}}]),ve=Z;const ge=ve;var fe=Y,z=fe.createSVGComponent(z,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:24,height:24},[{elem:"path",attrs:{d:"M29,26H3a1,1,0,0,1-1-1V8A1,1,0,0,1,3,7H9.46l1.71-2.55A1,1,0,0,1,12,4h8a1,1,0,0,1,.83.45L22.54,7H29a1,1,0,0,1,1,1V25A1,1,0,0,1,29,26ZM4,24H28V9H22a1,1,0,0,1-.83-.45L19.46,6H12.54L10.83,8.55A1,1,0,0,1,10,9H4Z"}},{elem:"path",attrs:{d:"M16,22a6,6,0,1,1,6-6A6,6,0,0,1,16,22Zm0-10a4,4,0,1,0,4,4A4,4,0,0,0,16,12Z"}}]),Ce=z;const Ae=Ce;var be=Y,W=be.createSVGComponent(W,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",width:24,height:24},[{elem:"path",attrs:{d:"M18,28A12,12,0,1,0,6,16v6.2L2.4,18.6,1,20l6,6,6-6-1.4-1.4L8,22.2V16H8A10,10,0,1,1,18,26Z"}}]),ke=W;const we=ke,Te="/design-system/assets/shutter.9f40c7bb.wav";function H(e,s=!1){const a=document.createElement("canvas"),r=a.getContext("2d");return a.width=e.videoWidth,a.height=e.videoHeight,s?(r.save(),r.scale(-1,1),r.drawImage(e,0,0,a.width*-1,a.height),r.restore()):r.drawImage(e,0,0,a.width,a.height),a.toDataURL("image/jpeg")}const Se={meta:{facingMode:"environment"},run({video:e,meta:s,modifier:a}){const r=!!(s.value.mirror&&s.value.mirror!=="preview"),l=H(e.value,r),t=a.value.base64?l:U(l);return{preview:l,result:t}}},xe=te({components:{pButton:J,IconCamera:Ae,IconRetake:we,IconRotate:ge},directives:{pAspectRatio:he},props:{modelValue:{type:[globalThis.File,String,Array],default:""},modelModifiers:{type:Object,default:()=>({})},mirror:{type:[Boolean,String],default:void 0},mask:{type:String,default:void 0},adapter:{type:Object,default:Se},facingMode:{type:String,default:void 0},silent:{type:Boolean,default:!1}},models:{prop:"modelValue",event:"update:modelValue"},emits:["start","change","result","update:modelValue"],setup(e,{emit:s}){const a=K(e),r=ne(e,"modelModifiers"),l=f(!1),t=f(!1),p=f(""),c=f(""),n=f(),h=f(),D=ee("camera",{controls:!0}),i=f(0),u=$(()=>re({mirror:e.mirror,mask:e.mask,facingMode:e.facingMode},e.adapter.meta,{autoStart:!1})),{videoInputs:g}=se({requestPermissions:!1,constraints:{video:{facingMode:u.value.facingMode}}}),T=$(()=>{var d,N;return(N=(d=g.value)==null?void 0:d.at(i.value))==null?void 0:N.deviceId}),{stream:C,start:S,stop:I,enabled:b}=ae({videoDeviceId:T,audioDeviceId:!1}),L=$(()=>{const d=[];return u.value.mirror&&d.push("camera--mirror"),u.value.mask?d.push(`camera__mask--${u.value.mask}`):d.push("camera__mask--none"),d});async function x(){var d;D.state.value==="denied"&&await Q({title:"Camera Access Blocked",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),D.state.value==="prompt"&&await Q({title:"Camera Access Required",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),await S(),typeof((d=h.value)==null?void 0:d.play)=="function"&&await h.value.play()}function E(){i.value=(i.value+1)%g.value.length}function M(d){c.value=d}async function q(){var N;l.value=!0;const d=await e.adapter.run({video:h,toast:M,stream:C,meta:u,modifier:r});p.value=d.preview,a.value=d.result,t.value=!0,l.value=!1,b.value=!1,s("result",d.result),s("change",d.result),typeof((N=n.value)==null?void 0:N.play)=="function"&&n.value.play()}async function R(){b.value=!0,t.value=!1,p.value="",c.value=""}function G(){s("start",C.value),u.value.autoStart&&q()}return oe(async()=>{D.isSupported&&(await De(D.state).not.toBeUndefined(),await x())}),le(()=>{I()}),{ShutterWav:Te,classNames:L,cameras:g,video:h,shutter:n,stream:C,toggle:E,isActive:b,isTaken:t,isProcessing:l,message:c,take:q,retake:R,preview:p,turnOn:x,onStart:G,toast:M,deviceId:T}}});const Pe=["data-deviceid"],Ve=[".srcObject"],Ie=["src"],Ee={key:2,"data-testid":"camera-off",class:"camera__off-info"},Me={class:"camera__mask-container"},qe={key:0,"data-testid":"camera-mask",class:"camera__mask"},Re={"data-testid":"camera-toast",class:"camera__toast-text"},Ne={class:"camera__controls"},Be=["src","muted"];function Oe(e,s,a,r,l,t){const p=B("icon-rotate"),c=B("p-button"),n=B("icon-camera"),h=B("icon-retake"),D=ce("p-aspect-ratio");return ie((_(),k("div",{class:me(["camera",e.classNames]),"data-testid":"camera","data-deviceid":e.deviceId},[e.stream?(_(),k("video",{key:0,ref:"video","data-testid":"camera-video",".srcObject":e.stream,class:"camera__video",autoplay:"",muted:"",playsinline:"",onPlay:s[0]||(s[0]=(...i)=>e.onStart&&e.onStart(...i))},null,40,Ve)):P("",!0),e.isTaken&&!e.stream?(_(),k("img",{key:1,"data-testid":"camera-result",class:"camera__result",src:e.preview,alt:"camera-result"},null,8,Ie)):P("",!0),!e.isActive&&!e.isTaken?(_(),k("span",Ee," Camera is off ")):P("",!0),m("div",Me,[e.isTaken?P("",!0):(_(),k("div",qe))]),o(de,{name:"slide-up"},{default:y(()=>[e.message?(_(),k("div",{key:e.message,class:"camera__toast"},[m("div",Re,j(e.message),1)])):P("",!0)]),_:1}),m("div",Ne,[e.cameras.length>1&&!e.isTaken?(_(),O(c,{key:0,"data-testid":"camera-toggle",color:"danger",size:"sm",icon:"",pill:"",onClick:e.toggle},{default:y(()=>[o(p)]),_:1},8,["onClick"])):P("",!0),!e.isActive&&!e.isTaken?(_(),O(c,{key:1,"data-testid":"camera-turn-on",class:"camera__main-control",color:"danger",icon:"",pill:"",onClick:s[1]||(s[1]=i=>e.turnOn())},{default:y(()=>[o(n)]),_:1})):e.isActive&&!e.isTaken?(_(),O(c,{key:2,"data-testid":"camera-take",class:"camera__main-control",color:"danger",icon:"",pill:"",disabled:e.isProcessing,onClick:s[2]||(s[2]=i=>e.take())},{default:y(()=>[o(n)]),_:1},8,["disabled"])):(_(),O(c,{key:3,"data-testid":"camera-retake",class:"camera__main-control",color:"danger",icon:"",pill:"",onClick:s[3]||(s[3]=i=>e.retake())},{default:y(()=>[o(h)]),_:1}))]),m("audio",{ref:"shutter",src:e.ShutterWav,muted:e.silent},null,8,Be),ue(e.$slots,"default",{cameras:e.cameras,preview:e.preview,stream:e.stream,video:e.video,shutter:e.shutter,toast:e.toast})],10,Pe)),[[D,4/3,void 0,{fixed:!0}]])}const F=pe(xe,[["render",Oe]]),He=40,Le=15,A=160;function $e(e,s){const a=e.getContext("2d",{willReadFrequently:!0});return a.drawImage(s,s.videoWidth/2-A,s.videoHeight/2-A,A,A,0,0,A,A),a.getImageData(0,0,e.width,e.height)}function Ue(e){const s=e.width/2,a=e.height/2,r=e.width/4,l=e.height/4,t=s-r/2,p=a-l/2,c=new Uint8ClampedArray(r*l),n={centerX:s,centerY:a,width:r,height:l,xPos:t,yPos:p,buffer:c},h=e.data;let D=0;for(let i=n.yPos;i<n.yPos+n.height;i++){let u=i*e.width*4+n.xPos*4+1;for(let g=n.xPos;g<n.xPos+n.width;g++)n.buffer[D++]=h[u],u+=4}return n}function je(e,s){let a=0,r=0,l=0;const t=e.width/4,p=e.height/4,c=e.data;for(let C=s.centerY-p;C<=s.centerY+p-s.height;C++)for(let S=s.centerX-t;S<=s.centerX+t-s.width;S++){let I=0,b=0,L=0;for(let E=0;E<s.height;E++){let M=S*4+1+(C+E)*e.width*4;for(let q=0;q<s.width;q++){const R=c[M];I+=s.buffer[L++]*R,b+=R*R,M+=4}}let x=0;b>0&&(x=I*I/b),x>l&&(l=x,a=S,r=C)}const n=a-s.xPos,h=r-s.yPos,D=Math.sqrt(n*n+h*h),i=t-s.width/2,u=p-s.height/2,g=Math.sqrt(i*i+u*u);let T=D/g*100;return T>100&&(T=100),T}const Ye={meta:{mask:"round",mirror:!0,facingMode:"user"},async run({video:e,toast:s,meta:a,modifier:r}){return await new Promise(l=>{const t=!!(a.value.mirror&&a.value.mirror!=="preview"),p=H(e.value,t),c=document.createElement("canvas");c.width=A,c.height=A;let n;const h=setInterval(function(){if(e.value){const i=$e(c,e.value);if(!n)n=Ue(i);else if(je(i,n)>He){const u=H(e.value,t),g=r.value.base64?[u,p]:[U(u),U(p)];clearInterval(h),s(""),l({preview:u,result:g})}}},1e3/Le);s("Move your head slowly. Your photo will be taken automatically")})}},Qe={meta:{mask:"square",facingMode:"environment",autoStart:!0},async run({video:e,toast:s,meta:a}){const r=!!(a.value.mirror&&a.value.mirror!=="preview"),{BrowserQRCodeReader:l}=await ye(()=>import("./chunks/index.232aa73f.js"),[]),p=await new l().decodeOnceFromVideoElement(e.value),c=H(e.value,r),n=p.getText();return s(n),{preview:c,result:n}}},Xe=v("",4),Ze=v("",3),ze=v("",3),We=v("",3),Ge=v("",3),Je=v("",3),Ke=v("",3),es=v("",3),ss=v("",2),as={class:"truncate"},ts=m("h3",{id:"encode-to-base64",tabindex:"-1"},[w("Encode to base64 "),m("a",{class:"header-anchor",href:"#encode-to-base64","aria-hidden":"true"},"#")],-1),ns=m("p",null,[w("You can add modifier "),m("code",null,"base64"),w(" to your "),m("code",null,"v-model"),w(", it's enforce result to "),m("a",{href:"https://en.wikipedia.org/wiki/Data_URI_scheme",target:"_blank",rel:"noreferrer"},"base64-dataURI"),w(".")],-1),os=m("b",null,"Note!",-1),ls=m("code",null,"v-model.base64",-1),rs=v("",2),ps={class:"truncate"},cs=v("",7),ws=JSON.parse(`{"title":"Camera · Components","description":"Take picture from user's camera","frontmatter":{"title":"Camera · Components","description":"Take picture from user's camera"},"headers":[{"level":2,"title":"Usage","slug":"usage","link":"#usage","children":[{"level":3,"title":"Simple Usage","slug":"simple-usage","link":"#simple-usage","children":[]}]},{"level":2,"title":"Mirror Mode","slug":"mirror-mode","link":"#mirror-mode","children":[{"level":3,"title":"Preview-only mirror mode","slug":"preview-only-mirror-mode","link":"#preview-only-mirror-mode","children":[]}]},{"level":2,"title":"Masking","slug":"masking","link":"#masking","children":[]},{"level":2,"title":"Silent","slug":"silent","link":"#silent","children":[]},{"level":2,"title":"Liveness","slug":"liveness","link":"#liveness","children":[]},{"level":2,"title":"QR Scanner","slug":"qr-scanner","link":"#qr-scanner","children":[]},{"level":2,"title":"Binding v-model","slug":"binding-v-model","link":"#binding-v-model","children":[{"level":3,"title":"Encode to base64","slug":"encode-to-base64","link":"#encode-to-base64","children":[]}]},{"level":2,"title":"API","slug":"api","link":"#api","children":[{"level":3,"title":"Props","slug":"props","link":"#props","children":[]},{"level":3,"title":"Slots","slug":"slots","link":"#slots","children":[]},{"level":3,"title":"Events","slug":"events","link":"#events","children":[]}]}],"relativePath":"components/camera/index.md"}`),is={name:"components/camera/index.md"},Ts=Object.assign(is,{setup(e){const s=f(),a=f();return(r,l)=>{const t=B("preview");return _(),k("div",null,[Xe,o(t,{class:"flex-col"},{default:y(()=>[o(F)]),_:1}),Ze,o(t,{class:"flex-col"},{default:y(()=>[o(F,{mirror:""})]),_:1}),ze,o(t,{class:"flex-col"},{default:y(()=>[o(F,{mirror:"preview"})]),_:1}),We,o(t,{class:"flex-col space-y-2"},{default:y(()=>[o(F,{mask:"square"}),o(F,{mask:"round"}),o(F,{mask:"card"})]),_:1}),Ge,o(t,{class:"flex-col"},{default:y(()=>[o(F,{silent:""})]),_:1}),Je,o(t,{class:"flex-col space-y-2"},{default:y(()=>[o(F,{adapter:V(Ye)},null,8,["adapter"])]),_:1}),Ke,o(t,{class:"flex-col space-y-2"},{default:y(()=>[o(F,{adapter:V(Qe)},null,8,["adapter"])]),_:1}),es,o(t,{class:"flex-col"},{default:y(()=>[o(F,{modelValue:V(s),"onUpdate:modelValue":l[0]||(l[0]=p=>X(s)?s.value=p:null)},null,8,["modelValue"])]),_:1}),ss,m("pre",as,[m("code",null,j(V(s)),1)]),ts,ns,o(Fe,{dismissable:!1},{default:y(()=>[os,w(),ls,w(" on QRCodeAdapter has no effect, the result will always original scanned text. ")]),_:1}),o(t,{class:"flex-col"},{default:y(()=>[o(F,{modelValue:V(a),"onUpdate:modelValue":l[1]||(l[1]=p=>X(a)?a.value=p:null),modelModifiers:{base64:!0}},null,8,["modelValue"])]),_:1}),rs,m("pre",ps,[m("code",null,j(V(a)),1)]),cs])}}});export{ws as __pageData,Ts as default};
